<?xml version="1.0" encoding="UTF-8"?>

<screen require-authentication="anonymous-all"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/xml-screen-2.1.xsd">

    <transition name="mkcontactinfo">
        <service-call name="MKSignUpServices.store#PartyContact" in-map="[partyId:partyId] + context" out-map="context"/>
        <default-response url="../MKWelcomePage"/>
    </transition>

    <transition name="logout">
        <actions>
            <script>ec.user.logoutUser()</script>
        </actions>
        <default-response url="../MKQuitPage"/>
        <error-response url="."/>
    </transition>

    <transition name="json" method="options" require-session-token="false">
        <default-response type="none" />
    </transition>

    <pre-actions><script>
        // if user not already logged in redirect to login page
        if (!ec.user.userId) sri.sendRedirectAndStopRender('./MKLoginPage')
    </script></pre-actions>


    <widgets>
        <!-- <render-mode>
            <text type="html,vuet" location="component://MKSignUp/screen/MKSignUp/Pages/MKContactForm.html"/>
        </render-mode> -->
        <label type="h1" text="Contact Information"/>
        <form-single name="MKContactForm" transition="mkcontactinfo">
            <field name="contactNumber"><default-field><text-line size="25"/></default-field></field>
            <field name="organizationName"><default-field>
                <drop-down combo-box="true" allow-empty="true">
                    <entity-options key="${organizationName}"
                    text="${organizationName}">
                        <entity-find entity-name="mantle.party.Organization">
                        </entity-find>
                    </entity-options>
                </drop-down>
            </default-field></field>
            <field name="address1"><default-field><text-line size="25"/></default-field></field>
            <field name="address2"><default-field><text-line size="25"/></default-field></field>
            <field name="postalCode"><default-field><text-line size="25"/></default-field></field>
            <field name="city"><default-field><text-line size="25"/></default-field></field>
            <field name="stateProvinceGeoId"><default-field>
                <drop-down allow-empty="true">
                    <entity-options key="${geoId}"
                    text="${geoName}">
                        <entity-find entity-name="moqui.basic.Geo">
                            <econdition field-name="geoTypeEnumId" value="GEOT_STATE"/>
                        </entity-find>
                    </entity-options>
                </drop-down>
            </default-field></field>
            <field name="submitButton"><default-field title="Submit"><submit/></default-field></field>
        </form-single>
        <link text="Save and Quit" url="../MKContactForm/logout"/>
    </widgets>


</screen> 